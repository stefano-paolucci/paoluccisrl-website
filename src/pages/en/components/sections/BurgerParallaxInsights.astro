---
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";
---

<section
  id="burgerInsightsEn"
  data-text-delay-steps="20"
  data-scroll-steps-total="200"
  data-text-start-offset-vh="92"
  class="relative hidden h-[260svh] lg:block">
  <div class="sticky top-0 h-svh overflow-hidden">
    <div data-bg class="absolute inset-0 will-change-transform">
      <OptimizedImage
        src="/src/assets/images/banner_home3.avif"
        alt=""
        class="size-full object-cover object-center"
        loading="eager"
        decoding="async"
      />
    </div>

    <div data-overlay class="absolute inset-0 bg-black will-change-[opacity]">
    </div>

    <div class="relative z-10 h-full">
      <div class="container mx-auto flex h-full items-center">
        <div data-content class="mx-auto w-full max-w-[1200px]">
          <h1
            class="mx-auto max-w-6xl text-center text-3xl leading-tight font-bold tracking-tight text-white lg:text-7xl">
            A choice you can feel every day.
          </h1>
          <h2
            class="mx-auto max-w-4xl text-center text-3xl leading-tight font-bold tracking-tight text-white lg:text-5xl">
            The difference between a standard window and a high-performance one.
          </h2>

          <div class="mx-auto mt-7 grid max-w-[1040px] grid-cols-2 gap-4">
            <article
              class="rounded-2xl border border-white/25 bg-black/35 p-6 text-white backdrop-blur-md">
              <h3 class="mb-4 text-xl leading-tight font-semibold text-white lg:text-3xl">
                Standard window
              </h3>

              <div class="grid grid-cols-2 gap-4">
                <p class="flex flex-col gap-1.5">
                  <span class="text-xs tracking-wider text-white/85 uppercase">
                    Thermal insulation
                  </span>
                  <strong class="text-2xl leading-tight font-bold lg:text-4xl">
                    Basic
                  </strong>
                </p>
                <p class="flex flex-col gap-1.5">
                  <span class="text-xs tracking-wider text-white/85 uppercase">
                    Acoustic comfort
                  </span>
                  <strong class="text-2xl leading-tight font-bold lg:text-4xl">
                    Limited
                  </strong>
                </p>
              </div>
            </article>

            <article
              class="rounded-2xl border border-white/30 bg-[#77B82D] p-6 text-white lg:col-start-2 lg:row-span-2">
              <h3 class="mb-4 text-xl leading-tight font-semibold text-white lg:text-3xl">
                High-performance windows
              </h3>

              <div class="grid grid-cols-2 gap-4">
                <p class="flex flex-col gap-1.5">
                  <span class="text-xs tracking-wider text-white/85 uppercase">
                    Thermal insulation
                  </span>
                  <strong class="text-2xl leading-tight font-bold lg:text-4xl">
                    Consistent
                  </strong>
                </p>
                <p class="flex flex-col gap-1.5">
                  <span class="text-xs tracking-wider text-white/85 uppercase">
                    Acoustic comfort
                  </span>
                  <strong class="text-2xl leading-tight font-bold lg:text-4xl">
                    High
                  </strong>
                </p>
              </div>

              <div class="mt-6 border-t border-white/30 pt-5 text-3xl leading-tight font-extrabold lg:text-5xl">
                +efficiency
                <br />
                +comfort
                <br />
                +long-term value
              </div>
            </article>

            <article
              class="rounded-2xl border border-white/25 bg-black/35 p-6 text-white backdrop-blur-md">
              <h3 class="mb-4 text-xl leading-tight font-semibold text-white lg:text-5xl">
                Result
              </h3>

              <div class="grid grid-cols-2 gap-4">
                <p class="flex flex-col gap-1.5">
                  <span class="text-xs tracking-wider text-white/80 uppercase">
                    Indoor stability
                  </span>
                  <strong class="text-2xl leading-tight font-bold lg:text-4xl">
                    Fluctuating
                  </strong>
                </p>
                <p class="flex flex-col gap-1.5">
                  <span class="text-xs tracking-wider text-white/80 uppercase">
                    Daily well-being
                  </span>
                  <strong class="text-2xl leading-tight font-bold lg:text-4xl">
                    Occasional
                  </strong>
                </p>
              </div>
            </article>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  (() => {
    const root = document.getElementById("burgerInsightsEn");
    if (!root) return;

    const desktopQuery = window.matchMedia("(min-width: 1024px)");
    const reducedMotionQuery = window.matchMedia(
      "(prefers-reduced-motion: reduce)",
    );

    const bg = root.querySelector("[data-bg]");
    const overlay = root.querySelector("[data-overlay]");
    const content = root.querySelector("[data-content]");

    const clamp = (value, min = 0, max = 1) =>
      Math.min(max, Math.max(min, value));
    const smoothstep = (t) => t * t * (3 - 2 * t);
    const toNumber = (value, fallback) => {
      const parsed = Number(value);
      return Number.isFinite(parsed) ? parsed : fallback;
    };

    const textDelaySteps = toNumber(root.dataset.textDelaySteps, 20);
    const totalSteps = Math.max(1, toNumber(root.dataset.scrollStepsTotal, 200));
    const textStartOffsetVh = clamp(
      toNumber(root.dataset.textStartOffsetVh, 92),
      0,
      180,
    );

    const textEntryStart = clamp(textDelaySteps / totalSteps, 0, 0.9);
    const textEntryEnd = clamp(textEntryStart + 0.9, textEntryStart + 0.08, 1);
    const getTextOffsetPx = () => window.innerHeight * (textStartOffsetVh / 100);

    let isTicking = false;

    function rangeProgress(progress, start, end) {
      const localProgress = clamp(
        (progress - start) / Math.max(0.0001, end - start),
      );
      return smoothstep(localProgress);
    }

    function getSectionProgress() {
      const rect = root.getBoundingClientRect();
      const scrollSpan = Math.max(1, root.offsetHeight - window.innerHeight);
      const travelled = clamp(-rect.top, 0, scrollSpan);
      return travelled / scrollSpan;
    }

    function setInitialState() {
      if (bg) bg.style.transform = "scale(1)";
      if (overlay) overlay.style.opacity = "0";
      if (content) {
        content.style.opacity = "1";
        content.style.transform = `translateY(${textStartOffsetVh}vh)`;
      }
    }

    function render(progress) {
      const bgMotion = rangeProgress(progress, 0, 1);
      const overlayIn = rangeProgress(progress, 0, 0.4);
      const contentIn = rangeProgress(progress, textEntryStart, textEntryEnd);

      if (bg) bg.style.transform = `scale(${1 + bgMotion * 0.07})`;
      if (overlay) overlay.style.opacity = String(overlayIn * 0.5);

      if (content) {
        content.style.opacity = "1";
        content.style.transform = `translateY(${(1 - contentIn) * getTextOffsetPx()}px)`;
      }
    }

    function update() {
      isTicking = false;
      if (!desktopQuery.matches || reducedMotionQuery.matches) {
        setInitialState();
        return;
      }
      render(getSectionProgress());
    }

    function requestUpdate() {
      if (isTicking) return;
      isTicking = true;
      requestAnimationFrame(update);
    }

    setInitialState();
    update();
    window.addEventListener("scroll", requestUpdate, { passive: true });
    window.addEventListener("resize", requestUpdate, { passive: true });
    desktopQuery.addEventListener("change", requestUpdate);
    reducedMotionQuery.addEventListener("change", requestUpdate);
  })();
</script>
