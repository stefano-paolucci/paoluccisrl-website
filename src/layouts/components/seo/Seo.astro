---
import { getLocaleUrlCTM, supportedLanguages } from "@/lib/utils/i18nUtils";
import { plainify, removeWhitespace } from "@/lib/utils/textConverter";
import config from ".astro/config.generated.json" with { type: "json" };

// Load the configuration
let {
  title,
  metaTitle,
  description,
  metaDescription,
  canonical,
  keywords = config.seo.keywords,
  disableTagline,
  author = config.seo.author,
  robots = config.seo.robots,
} = Astro.props;

title = plainify(metaTitle ? metaTitle : title ? title : config.site.title);
keywords = keywords.join(", ");

// Add tagline & separator to title
if (!disableTagline) {
  title =
    title +
    (config.site.tagline &&
      (config.site.taglineSeparator || " - ") + config.site.tagline);
}

description = plainify(
  metaDescription
    ? metaDescription
    : description
      ? description
      : config.site.description,
);

canonical = getLocaleUrlCTM(
  new URL(Astro.url.href, Astro.site).href,
  Astro.currentLocale,
);

const alternateTags: Array<{ hreflang: string; href: string }> = [];
// If multilingual is enabled, add rel alternate link tags
if (
  config.settings.multilingual.enable &&
  !canonical.includes("blog/category/")
) {
  supportedLanguages.forEach((lang) => {
    alternateTags.push({
      hreflang: lang.languageCode,
      href: getLocaleUrlCTM(Astro.url.href, lang.languageCode),
    });
  });
}
---

{title && <title>{removeWhitespace(title)}</title>}
{
  description && (
    <meta name="description" content={removeWhitespace(description)} />
  )
}
{keywords && <meta name="keywords" content={removeWhitespace(keywords)} />}
{author && <meta name="author" content={removeWhitespace(author)} />}
{robots && <meta name="robots" content={removeWhitespace(robots)} />}
{canonical && <link rel="canonical" href={canonical} item-prop="url" />}
{
  alternateTags &&
    alternateTags.map((tag) => (
      <link rel="alternate" hreflang={tag.hreflang} href={tag.href} />
    ))
}
