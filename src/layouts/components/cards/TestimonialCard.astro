---
import { markdownify } from "@/lib/utils/textConverter";
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";
import { generateStars } from "@/shortcodes/Testimonial.astro";

const { class: className, ...rest } = Astro.props;
let { enable, rating, customer, content } = Astro.props.content || {};

rating = new Array(1).fill(null);

if (!enable) return;
---

<div
  class:list={[
    "bg-theme-light group relative flex w-full flex-col items-start rounded-xl border-4 border-white p-6",
    className,
  ]}
  {...rest}>
  <div class="flex flex-col items-start space-y-4">
    {
      content && (
        <blockquote
          class="text-lg leading-relaxed"
          set:html={markdownify(content)}
        />
      )
    }

    {
      rating && (
        <div class="inline-flex gap-2 rounded-sm bg-white px-2.5 py-1.5">
          {generateStars(rating).map((_) => (
            <svg
              class="h-3 w-3 fill-current text-yellow-500"
              viewBox="0 0 20 20"
              fill="currentColor">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          ))}
        </div>
      )
    }
    <div class="relative">
      <svg
        class="w-full transition-transform duration-300 group-hover:rotate-12"
        width="376"
        height="200"
        viewBox="0 0 376 308"
        fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <g>
          <path
            d="M24 226.005L347.249 82.0205"
            stroke="white"
            stroke-width="140">
          </path>
        </g>
      </svg>
      <div
        class="pointer-events-none absolute right-0 bottom-0 left-0 z-10 h-[calc(70%+1.5rem)] w-full">
        <div
          class="absolute inset-0 z-35 mask-[linear-gradient(rgba(0,0,0,0),rgba(0,0,0,1)_10%,rgba(0,0,0,1)_30%,rgba(0,0,0,0)_40%)] backdrop-blur-[1px]">
        </div>
        <div
          class="absolute inset-0 z-30 mask-[linear-gradient(rgba(0,0,0,0)_10%,rgba(0,0,0,1)_20%,rgba(0,0,0,1)_40%,rgba(0,0,0,0)_50%)] backdrop-blur-[2px]">
        </div>
        <div
          class="absolute inset-0 z-25 mask-[linear-gradient(rgba(0,0,0,0)_15%,rgba(0,0,0,1)_30%,rgba(0,0,0,1)_50%,rgba(0,0,0,0)_60%)] backdrop-blur-xs">
        </div>
        <div
          class="absolute inset-0 z-20 mask-[linear-gradient(rgba(0,0,0,0)_20%,rgba(0,0,0,1)_40%,rgba(0,0,0,1)_60%,rgba(0,0,0,0)_70%)] backdrop-blur-sm">
        </div>
        <div
          class="absolute inset-0 z-15 mask-[linear-gradient(rgba(0,0,0,0)_40%,rgba(0,0,0,1)_60%,rgba(0,0,0,1)_80%,rgba(0,0,0,0)_90%)] backdrop-blur-lg">
        </div>
        <div
          class="absolute inset-0 z-10 mask-[linear-gradient(rgba(0,0,0,0)_60%,rgba(0,0,0,1)_80%)] backdrop-blur-[32px]">
        </div>
        <div
          class="absolute inset-0 z-5 mask-[linear-gradient(rgba(0,0,0,0)_70%,rgba(0,0,0,1)_100%)] backdrop-blur-[52px]">
        </div>
      </div>
    </div>
  </div>

  <div class="mt-auto flex items-center gap-4">
    {
      customer.avatar && (
        <OptimizedImage
          src={customer.avatar}
          alt={customer.name}
          class="h-12 w-12 rounded-full object-cover"
        />
      )
    }
    <div class="min-w-0 flex-1 space-y-1">
      {customer.name && <div>{customer.name}</div>}
      {customer.role && <p class="text-sm text-black">{customer.role}</p>}
    </div>
  </div>
</div>
