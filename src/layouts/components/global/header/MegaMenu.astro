---
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";
import type { NavigationLink } from "@/types";
import { getLocaleUrlCTM } from "@/lib/utils/i18nUtils";
import CustomButton from "@/components/CustomButton.astro";
import Icons from "@/helpers/Icons.astro";

const menu = Astro.props.menu as NavigationLink;
const enabledMenus = menu.menus?.filter((menu) => menu.enable) || [];

const IsMultiColMenu = enabledMenus.length >= 2;
---

<div
  class:list={[
    "hs-dropdown-menu mega-menu hs-dropdown-open:pointer-events-auto hs-dropdown-open:opacity-100 hs-dropdown-open:mt-2! pointer-events-none top-0 mt-4 hidden max-h-[90vh] overflow-auto overflow-x-hidden rounded-xl border bg-white opacity-0 transition-[opacity,margin] max-lg:static! max-lg:transform-none! lg:absolute lg:left-0 lg:h-fit lg:w-fit",
  ]}>
  <div class="md:flex">
    {
      menu.menus && enabledMenus.length > 0 && (
        <div
          class:list={[
            "p-2.5 md:p-5 lg:flex lg:flex-row lg:flex-wrap lg:justify-between",
          ]}>
          {menu.menus
            .filter((menu) => menu.enable)
            .map((menu) => (
              <ul
                class:list={[
                  "[&>li:not(:first-child)>a]:py-3",
                  {
                    "lg:w-1/2": IsMultiColMenu,
                    "w-full md:w-[320px]": !IsMultiColMenu,
                  },
                ]}>
                {menu.children?.map((child) => (
                  <li role="menuitem">
                    <a
                      {...{
                        // Set `rel` attribute for external links or use provided value
                        rel: child.url?.startsWith("http")
                          ? child.rel || "noopener noreferrer"
                          : child.rel || undefined,

                        // Set `target` to "_blank" for external links unless otherwise specified
                        target: child.url?.startsWith("http")
                          ? child.target || "_blank"
                          : child.target || undefined,
                      }}
                      target={
                        child.url?.startsWith("http") ? "_blank" : undefined
                      }
                      href={getLocaleUrlCTM(
                        child.url || Astro.url.origin,
                        Astro.currentLocale,
                      )}
                      class="group/item flex gap-x-8 rounded-lg p-4 text-inherit transition-colors">
                      {child.icon && (
                        <span class="relative -mt-0.5 inline-block min-w-4 bg-white">
                          <span
                            aria-hidden="true"
                            class="translate-x-centered bg-border-light absolute bottom-full h-px w-10 transition-all duration-300 group-hover/item:bg-black/30"
                          />
                          <span
                            aria-hidden="true"
                            class="translate-x-centered bg-border-light absolute top-8 h-px w-10 transition-all duration-300 group-hover/item:bg-black/30"
                          />

                          <span
                            aria-hidden="true"
                            class="bg-border-light absolute -top-2.5 -left-2 h-12 w-px transition-all duration-300 group-hover/item:bg-black/30"
                          />
                          <span
                            aria-hidden="true"
                            class="bg-border-light absolute -top-2.5 -right-2 h-12 w-px transition-all duration-300 group-hover/item:bg-black/30"
                          />
                          <Icons
                            icon={child.icon as any}
                            class="text-text-default mt-1 inline-block h-4 w-4"
                          />
                        </span>
                      )}
                      <div class="space-y-1">
                        {child.name && (
                          <div
                            class="text-lg tracking-normal"
                            set:html={child.name}
                          />
                        )}
                        {child.description && (
                          <p
                            class="text-sm/relaxed opacity-80"
                            set:html={child.description}
                          />
                        )}
                      </div>
                    </a>
                  </li>
                ))}
              </ul>
            ))}
        </div>
      )
    }

    {
      menu.cta && menu.cta.enable && (
        <div
          class:list={[
            "w-full space-y-5 bg-slate-50 p-5 md:ms-auto md:w-[320px]",
            {
              "w-full": IsMultiColMenu,
            },
          ]}>
          {menu.cta.image && (
            <OptimizedImage
              width={300}
              src={menu.cta.image}
              class="h-72 w-full rounded-xl object-cover object-top md:h-52"
            />
          )}
          <div class="space-y-1.5">
            {menu.cta.title && (
              <div class="text-lg tracking-normal" set:html={menu.cta.title} />
            )}
            {menu.cta.description && (
              <p
                class="text-sm/relaxed opacity-80"
                set:html={menu.cta.description}
              />
            )}
          </div>
          {menu.cta.button?.enable && (
            <CustomButton
              {...menu.cta.button}
              content={menu.cta.button}
              class=""
            />
          )}
        </div>
      )
    }
  </div>
</div>
