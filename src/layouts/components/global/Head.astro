---
import SEO from "@/components/seo/Seo.astro";
import JsonLD from "../widgets/JsonLD.astro";
import Favicons from "@/components/seo/Favicons.astro";
import OpenGraph from "@/components/seo/OpenGraph.astro";
import config from ".astro/config.generated.json" with { type: "json" };
import { Font } from "astro:assets";
import fontsJson from "@/config/fonts.json";

const fontVariables = fontsJson.map((font) => font.cssVariable) as any[];
---

<head>
  <script is:inline>
    (() => {
      const key = "theme-preference";
      const root = document.documentElement;
      const saved = localStorage.getItem(key);
      const preference =
        saved === "light" || saved === "dark" || saved === "system"
          ? saved
          : "system";
      const resolved =
        preference === "system"
          ? window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light"
          : preference;

      root.dataset.themePreference = preference;
      root.dataset.theme = resolved;
    })();
  </script>
  <!------------
    General
-------------->
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Language" content={Astro.currentLocale} />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=5"
  />
  <SEO {...Astro.props} />
  <meta
    name="theme-color"
    media="(prefers-color-scheme: light)"
    content="#fff"
  />
  <meta
    name="theme-color"
    media="(prefers-color-scheme: dark)"
    content="#262626"
  />
  <meta name="generator" content={Astro.generator} />
  {
    config.head?.content && (
      // Injecting custom scripts such as Google Analytics, Google Tag Manager, etc. tracking code,
      // which should be placed in <head> tag
      <Fragment set:html={config.head?.content} />
    )
  }
  <OpenGraph {...Astro.props} />
  <Favicons />
  <JsonLD
    content={{
      ...Astro.props,
    }}
  />
  <style>
    body {
      display: flex;
      flex-direction: column;
      min-height: 110vh;
    }
  </style>

  <!------------------
    Fonts
-------------------->
  {fontVariables.map((font) => <Font cssVariable={font} />)}
</head>
