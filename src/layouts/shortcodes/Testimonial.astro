---
/**
 * Example Usage

  <Testimonial
    customerImage="/images/customers/avatar/1.jpg"
    customerName="Sarah Jones"
    customerRole="CEO, Founder"
    customerCompanyLogo="/images/customers/company-logo/acme.png"
    customerCompanyName="Acme Inc."
  >
    Our partnership with Stella demonstrates the power of a well-executed customer
    engagement strategy. By integrating advanced technologies and data-driven
    insights, we helped them achieve a more personalized, consistent, and
    rewarding customer experience. At Stella, we are committed to helping
    businesses like Oloyon revolutionize their customer engagement and drive
    long-term success.
  </Testimonial>

 */
import { markdownify } from "@/lib/utils/textConverter";
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";

interface Props {
  class?: string;
  customerImage?: string;
  customerName?: string;
  customerRole?: string;
  customerCompanyLogo?: string;
  customerCompanyName?: string;
}

const {
  class: className,
  customerImage,
  customerName,
  customerRole,
  customerCompanyLogo,
  customerCompanyName,
} = Astro.props;

export const generateStars = (rating: any) => {
  const fullStars = Math.floor(rating);

  return Array.from({ length: 5 }, (_, i) => ({
    filled: i < fullStars,
    key: i,
  }));
};

let rating = new Array(5).fill(null);
---

<div
  class:list={[
    "testimonial-component not-prose relative flex w-full bg-white/5 p-6 " +
      className,
  ]}>
  <div class="flex flex-col justify-between space-y-8">
    <div class="space-y-8">
      {
        customerCompanyName && (
          <div class="flex flex-wrap-reverse items-center justify-between gap-3 opacity-70">
            <div class="flex items-center gap-2">
              {customerCompanyLogo && (
                <OptimizedImage
                  class="w-6"
                  height={24}
                  src={customerCompanyLogo}
                  alt={customerCompanyName}
                />
              )}
              {customerCompanyName && (
                <div
                  class="whitespace-nowrap"
                  set:html={markdownify(customerCompanyName)}
                />
              )}
            </div>
          </div>
        )
      }
      <div class="prose-styles">
        <slot />
      </div>
    </div>
    {
      customerName && (
        <div class="flex flex-wrap-reverse items-center justify-between gap-x-2 gap-y-10">
          <div class="flex items-center gap-4">
            {customerImage && (
              <OptimizedImage
                class="h-12 w-12 rounded-full"
                width={48}
                height={48}
                src={customerImage}
                alt={customerName}
              />
            )}
            <div>
              {customerName && <div set:html={markdownify(customerName)} />}
              {customerRole && (
                <p class="text-sm" set:html={markdownify(customerRole)} />
              )}
            </div>
          </div>
          <div class="flex items-center gap-2 rounded-full px-3 py-1.5">
            {rating && (
              <div class="bg-theme-light inline-flex gap-2 rounded-sm px-2.5 py-1.5">
                {generateStars(rating).map((_) => (
                  <svg
                    class="h-3 w-3 fill-current text-yellow-500"
                    viewBox="0 0 20 20"
                    fill="currentColor">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                ))}
              </div>
            )}
          </div>
        </div>
      )
    }
  </div>
</div>
