---
/**
 * Example Usage

  <ImageList>
    <ImageItem
      imageSrc="/images/ImageList/1.jpg"
      imageAlt="example alt text"
      videoSrc="rFVpSwgCkCo"
    />
    <ImageItem
      imageSrc="/images/ImageList/2.jpg"
      imageAlt="example alt text"
      videoSrc="/videos/test-video.mp4"
      videoProvider="html5"
    />
    <ImageItem
      width="1/2"
      imageSrc="/images/ImageList/3.jpg"
      imageAlt="example alt text"
    />
    <ImageItem
      width="1/2"
      imageSrc="/images/ImageList/4.jpg"
      imageAlt="example alt text"
    />
  </ImageList>

 */
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";
import VideoModal from "@/components/widgets/VideoModal.astro";
import Icons from "@/helpers/Icons.astro";
import type { VideoConfig } from "@/types";

type Card = {
  width?: "1/2" | "1/3";
  imageAlt?: string;
  imageSrc: string;
  videoSrc?: string;
  videoId?: string;
  videoProvider?: VideoConfig["provider"];
};

type Props = Card & {
  class?: any;
  imageSource?: string;
};

let {
  width,
  imageSrc,
  imageAlt,
  videoSrc,
  videoId,
  videoProvider = "youtube",
  class: className,
} = Astro.props;

function generateElementId(str: string) {
  // Remove any non-alphanumeric characters from the start of the string
  str = str.replace(/^[^a-zA-Z0-9]+/, "");

  // Replace all remaining non-alphanumeric characters with hyphens
  return str.replace(/[^a-zA-Z0-9]/g, "-");
}

// Generate a unique ID for the video modal
const id = videoId
  ? videoId
  : videoSrc
    ? generateElementId(videoSrc)
    : undefined;
---

{
  imageSrc && (
    <div
      class="not-prose relative"
      class:list={[
        {
          "col-span-6": !width,
          "col-span-3": width === "1/2",
          "col-span-2": width === "1/3",
        },
        className,
      ]}>
      <OptimizedImage
        width={900}
        height={400}
        src={imageSrc}
        alt={imageAlt || "alt text"}
        class:list={["!h-72 w-full !max-w-full object-cover md:!h-96"]}
      />
      {videoSrc && (
        <>
          <button
            type="button"
            title="Play Video"
            aria-haspopup="dialog"
            aria-expanded="false"
            video-config={JSON.stringify({
              id,
              src: videoSrc,
              provider: videoProvider,
            })}
            aria-controls={"#" + id}
            data-hs-overlay={"#" + id}
            data-hs-overlay-options={`{"emulateScrollbarSpace" : true}`}
            class="video-modal-toggle translate-centered has-animated-waves waves-white absolute flex h-20 w-20 items-center justify-center rounded-full transition-transform duration-300 hover:scale-110 lg:h-20 lg:w-20">
            <div class="relative z-10 flex h-20 w-20 items-center justify-center rounded-full">
              <Icons icon="Play" class="icon fill-theme-light text-dark" />
            </div>
          </button>
          <VideoModal
            video={{
              id,
              src: videoSrc,
              provider: videoProvider,
            }}
          />
        </>
      )}
    </div>
  )
}
